<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>연합뉴스TV 뉴스</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .news-item { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    .news-item img { max-width: 100%; height: auto; display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>연합뉴스TV 최신 뉴스</h1>
  <div id="news">로딩 중...</div>

  <script>
    const workerURL = 'https://webnews.rock0424.workers.dev/'; // Worker URL
    const newsContainer = document.getElementById('news');

    async function loadNews() {
      try {
        const res = await fetch(workerURL); // 전체 최신 뉴스
        const text = await res.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, "application/xml");
        const items = xml.querySelectorAll('item');
        newsContainer.innerHTML = '';

        items.forEach(item => {
          const title = item.querySelector('title')?.textContent || '';
          const link = item.querySelector('link')?.textContent || '';

          // content:encoded 가져오기
          const CONTENT_NS = 'http://purl.org/rss/1.0/modules/content/';
          const contentEncodedEl = item.getElementsByTagNameNS(CONTENT_NS, 'encoded')[0];
          const contentEncoded = contentEncodedEl?.textContent || '';

          let finalContent = contentEncoded;

          // content:encoded 안에 이미지가 없으면 enclosure 사용
          if (!contentEncoded.includes('<img') && item.querySelector('enclosure')) {
            const image = item.querySelector('enclosure')?.getAttribute('url');
            if (image) {
              finalContent = `<img src="${image}"><p>${contentEncoded}</p>`;
            }
          }

          const div = document.createElement('div');
          div.className = 'news-item';
          div.innerHTML = `
            <a href="${link}" target="_blank"><h3>${title}</h3></a>
            <div>${finalContent}</div>
          `;
          newsContainer.appendChild(div);
        });
      } catch (err) {
        newsContainer.innerHTML = '뉴스를 불러오는데 실패했습니다.';
        console.error(err);
      }
    }

    loadNews(); // 페이지 로드 시 뉴스 불러오기
  </script>
</body>
</html>
